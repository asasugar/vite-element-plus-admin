import{_ as A}from"./index.311e097d.js";/* empty css                 *//* empty css                        *//* empty css                    *//* empty css               */import"./el-tooltip.89296c46.js";/* empty css                  *//* empty css                     *//* empty css                  */import{A as w}from"./page-wrapper.85f5bc98.js";import{r as $,u as N}from"./xlsx.e6952222.js";import{as as U,d as I,b as v,u as b,A as i,J as C,aq as Y,Q as E,aa as P,at as T,ao as V,ap as j,a7 as L,B as S,R as k,P as R,S as M,a3 as B,a2 as F,N as W}from"./element-plus.dee36745.js";import"./mockjs.f3824721.js";/* empty css                */const Z=U,q=I({name:"ImportExcel",props:{dateFormat:{type:String},timeZone:{type:Number,default:8}},emits:["success","error"],setup(l,{emit:a}){const d=v(null),p=v(!1);function y(e){if(!e||!e["!ref"])return[];const t=[],r=N.decode_range(e["!ref"]),_=r.s.r;for(let n=r.s.c;n<=r.e.c;++n){const o=e[N.encode_cell({c:n,r:_})];let h="UNKNOWN "+n;o&&o.t&&(h=N.format_cell(o)),t.push(h)}return t}function f(e){const t=[],{dateFormat:r,timeZone:_}=l;for(const n of e.SheetNames){const o=e.Sheets[n],h=y(o);let g=N.sheet_to_json(o,{raw:!0,dateNF:r});g=g.map(u=>{for(let D in u)u[D]instanceof Date&&(_===8&&u[D].setSeconds(u[D].getSeconds()+43),r&&(u[D]=Z(u[D]).format(r)));return u}),t.push({header:h,results:g,meta:{sheetName:n}})}return t}function s(e){return p.value=!0,new Promise((t,r)=>{const _=new FileReader;_.onload=async n=>{try{const o=n.target&&n.target.result,h=$(o,{type:"array",cellDates:!0}),g=f(h);a("success",g),t("")}catch(o){r(o),a("error")}finally{p.value=!1}},_.readAsArrayBuffer(e)})}async function x(e){const t=b(d);t&&(t.value=""),await s(e)}function m(e){const r=e?.target?.files?.[0];!r||x(r)}function c(){b(d)?.click()}return{handleUpload:c,handleInputClick:m,inputRef:d}}});function z(l,a,d,p,y,f){return i(),C("div",null,[Y(E("input",{ref:"inputRef",type:"file",accept:".xlsx, .xls",onChange:a[0]||(a[0]=(...s)=>l.handleInputClick&&l.handleInputClick(...s))},null,544),[[T,!1]]),E("div",{onClick:a[1]||(a[1]=(...s)=>l.handleUpload&&l.handleUpload(...s))},[P(l.$slots,"default")])])}const H=A(q,[["render",z]]),J={class:"flex center"},ue=I({__name:"import",setup(l){let a=v([]);const d=p=>{a.value=[];for(const y of p){const{header:f,results:s,meta:{sheetName:x}}=y,m=[];for(const c of f)m.push({title:c,dataIndex:c});a.value.push({title:x,dataSource:s,columns:m})}};return(p,y)=>{const f=W,s=V,x=j,m=L;return i(),S(b(w),{"header-title":"Excel \u5BFC\u5165\u6F14\u793A"},{extra:k(()=>[E("div",J,[R(b(H),{"date-format":"YYYY-MM-DD",onSuccess:d},{default:k(()=>[R(f,{type:"primary"},{default:k(()=>[M("\u5BFC\u5165Excel")]),_:1})]),_:1})])]),bodyContent:k(()=>[a.value.length?(i(!0),C(F,{key:0},B(a.value,(c,e)=>(i(),S(x,{key:e,border:"","highlight-current-row":"",style:{width:"100%"},data:c.dataSource},{default:k(()=>[(i(!0),C(F,null,B(c.columns,t=>(i(),S(s,{key:t.dataIndex,prop:t.dataIndex,label:t.title,resizable:""},null,8,["prop","label"]))),128))]),_:2},1032,["data"]))),128)):(i(),S(m,{key:1,description:"No Data"}))]),_:1})}}});export{ue as default};
